revoke delete on table "public"."api_keys" from "anon";

revoke insert on table "public"."api_keys" from "anon";

revoke references on table "public"."api_keys" from "anon";

revoke select on table "public"."api_keys" from "anon";

revoke trigger on table "public"."api_keys" from "anon";

revoke truncate on table "public"."api_keys" from "anon";

revoke update on table "public"."api_keys" from "anon";

revoke delete on table "public"."api_keys" from "authenticated";

revoke insert on table "public"."api_keys" from "authenticated";

revoke references on table "public"."api_keys" from "authenticated";

revoke select on table "public"."api_keys" from "authenticated";

revoke trigger on table "public"."api_keys" from "authenticated";

revoke truncate on table "public"."api_keys" from "authenticated";

revoke update on table "public"."api_keys" from "authenticated";

revoke delete on table "public"."api_keys" from "service_role";

revoke insert on table "public"."api_keys" from "service_role";

revoke references on table "public"."api_keys" from "service_role";

revoke select on table "public"."api_keys" from "service_role";

revoke trigger on table "public"."api_keys" from "service_role";

revoke truncate on table "public"."api_keys" from "service_role";

revoke update on table "public"."api_keys" from "service_role";

revoke delete on table "public"."entitlements" from "anon";

revoke insert on table "public"."entitlements" from "anon";

revoke references on table "public"."entitlements" from "anon";

revoke select on table "public"."entitlements" from "anon";

revoke trigger on table "public"."entitlements" from "anon";

revoke truncate on table "public"."entitlements" from "anon";

revoke update on table "public"."entitlements" from "anon";

revoke delete on table "public"."entitlements" from "authenticated";

revoke insert on table "public"."entitlements" from "authenticated";

revoke references on table "public"."entitlements" from "authenticated";

revoke select on table "public"."entitlements" from "authenticated";

revoke trigger on table "public"."entitlements" from "authenticated";

revoke truncate on table "public"."entitlements" from "authenticated";

revoke update on table "public"."entitlements" from "authenticated";

revoke delete on table "public"."entitlements" from "service_role";

revoke insert on table "public"."entitlements" from "service_role";

revoke references on table "public"."entitlements" from "service_role";

revoke select on table "public"."entitlements" from "service_role";

revoke trigger on table "public"."entitlements" from "service_role";

revoke truncate on table "public"."entitlements" from "service_role";

revoke update on table "public"."entitlements" from "service_role";

revoke delete on table "public"."organization_members" from "anon";

revoke insert on table "public"."organization_members" from "anon";

revoke references on table "public"."organization_members" from "anon";

revoke select on table "public"."organization_members" from "anon";

revoke trigger on table "public"."organization_members" from "anon";

revoke truncate on table "public"."organization_members" from "anon";

revoke update on table "public"."organization_members" from "anon";

revoke delete on table "public"."organization_members" from "authenticated";

revoke insert on table "public"."organization_members" from "authenticated";

revoke references on table "public"."organization_members" from "authenticated";

revoke select on table "public"."organization_members" from "authenticated";

revoke trigger on table "public"."organization_members" from "authenticated";

revoke truncate on table "public"."organization_members" from "authenticated";

revoke update on table "public"."organization_members" from "authenticated";

revoke delete on table "public"."organization_members" from "service_role";

revoke insert on table "public"."organization_members" from "service_role";

revoke references on table "public"."organization_members" from "service_role";

revoke select on table "public"."organization_members" from "service_role";

revoke trigger on table "public"."organization_members" from "service_role";

revoke truncate on table "public"."organization_members" from "service_role";

revoke update on table "public"."organization_members" from "service_role";

revoke delete on table "public"."organizations" from "anon";

revoke insert on table "public"."organizations" from "anon";

revoke references on table "public"."organizations" from "anon";

revoke select on table "public"."organizations" from "anon";

revoke trigger on table "public"."organizations" from "anon";

revoke truncate on table "public"."organizations" from "anon";

revoke update on table "public"."organizations" from "anon";

revoke delete on table "public"."organizations" from "authenticated";

revoke insert on table "public"."organizations" from "authenticated";

revoke references on table "public"."organizations" from "authenticated";

revoke select on table "public"."organizations" from "authenticated";

revoke trigger on table "public"."organizations" from "authenticated";

revoke truncate on table "public"."organizations" from "authenticated";

revoke update on table "public"."organizations" from "authenticated";

revoke delete on table "public"."organizations" from "service_role";

revoke insert on table "public"."organizations" from "service_role";

revoke references on table "public"."organizations" from "service_role";

revoke select on table "public"."organizations" from "service_role";

revoke trigger on table "public"."organizations" from "service_role";

revoke truncate on table "public"."organizations" from "service_role";

revoke update on table "public"."organizations" from "service_role";

revoke delete on table "public"."projects" from "anon";

revoke insert on table "public"."projects" from "anon";

revoke references on table "public"."projects" from "anon";

revoke select on table "public"."projects" from "anon";

revoke trigger on table "public"."projects" from "anon";

revoke truncate on table "public"."projects" from "anon";

revoke update on table "public"."projects" from "anon";

revoke delete on table "public"."projects" from "authenticated";

revoke insert on table "public"."projects" from "authenticated";

revoke references on table "public"."projects" from "authenticated";

revoke select on table "public"."projects" from "authenticated";

revoke trigger on table "public"."projects" from "authenticated";

revoke truncate on table "public"."projects" from "authenticated";

revoke update on table "public"."projects" from "authenticated";

revoke delete on table "public"."projects" from "service_role";

revoke insert on table "public"."projects" from "service_role";

revoke references on table "public"."projects" from "service_role";

revoke select on table "public"."projects" from "service_role";

revoke trigger on table "public"."projects" from "service_role";

revoke truncate on table "public"."projects" from "service_role";

revoke update on table "public"."projects" from "service_role";

revoke delete on table "public"."stripe_customers" from "anon";

revoke insert on table "public"."stripe_customers" from "anon";

revoke references on table "public"."stripe_customers" from "anon";

revoke select on table "public"."stripe_customers" from "anon";

revoke trigger on table "public"."stripe_customers" from "anon";

revoke truncate on table "public"."stripe_customers" from "anon";

revoke update on table "public"."stripe_customers" from "anon";

revoke delete on table "public"."stripe_customers" from "authenticated";

revoke insert on table "public"."stripe_customers" from "authenticated";

revoke references on table "public"."stripe_customers" from "authenticated";

revoke select on table "public"."stripe_customers" from "authenticated";

revoke trigger on table "public"."stripe_customers" from "authenticated";

revoke truncate on table "public"."stripe_customers" from "authenticated";

revoke update on table "public"."stripe_customers" from "authenticated";

revoke delete on table "public"."stripe_customers" from "service_role";

revoke insert on table "public"."stripe_customers" from "service_role";

revoke references on table "public"."stripe_customers" from "service_role";

revoke select on table "public"."stripe_customers" from "service_role";

revoke trigger on table "public"."stripe_customers" from "service_role";

revoke truncate on table "public"."stripe_customers" from "service_role";

revoke update on table "public"."stripe_customers" from "service_role";

revoke delete on table "public"."stripe_payment_methods" from "anon";

revoke insert on table "public"."stripe_payment_methods" from "anon";

revoke references on table "public"."stripe_payment_methods" from "anon";

revoke select on table "public"."stripe_payment_methods" from "anon";

revoke trigger on table "public"."stripe_payment_methods" from "anon";

revoke truncate on table "public"."stripe_payment_methods" from "anon";

revoke update on table "public"."stripe_payment_methods" from "anon";

revoke delete on table "public"."stripe_payment_methods" from "authenticated";

revoke insert on table "public"."stripe_payment_methods" from "authenticated";

revoke references on table "public"."stripe_payment_methods" from "authenticated";

revoke select on table "public"."stripe_payment_methods" from "authenticated";

revoke trigger on table "public"."stripe_payment_methods" from "authenticated";

revoke truncate on table "public"."stripe_payment_methods" from "authenticated";

revoke update on table "public"."stripe_payment_methods" from "authenticated";

revoke delete on table "public"."stripe_payment_methods" from "service_role";

revoke insert on table "public"."stripe_payment_methods" from "service_role";

revoke references on table "public"."stripe_payment_methods" from "service_role";

revoke select on table "public"."stripe_payment_methods" from "service_role";

revoke trigger on table "public"."stripe_payment_methods" from "service_role";

revoke truncate on table "public"."stripe_payment_methods" from "service_role";

revoke update on table "public"."stripe_payment_methods" from "service_role";

revoke delete on table "public"."stripe_subscriptions" from "anon";

revoke insert on table "public"."stripe_subscriptions" from "anon";

revoke references on table "public"."stripe_subscriptions" from "anon";

revoke select on table "public"."stripe_subscriptions" from "anon";

revoke trigger on table "public"."stripe_subscriptions" from "anon";

revoke truncate on table "public"."stripe_subscriptions" from "anon";

revoke update on table "public"."stripe_subscriptions" from "anon";

revoke delete on table "public"."stripe_subscriptions" from "authenticated";

revoke insert on table "public"."stripe_subscriptions" from "authenticated";

revoke references on table "public"."stripe_subscriptions" from "authenticated";

revoke select on table "public"."stripe_subscriptions" from "authenticated";

revoke trigger on table "public"."stripe_subscriptions" from "authenticated";

revoke truncate on table "public"."stripe_subscriptions" from "authenticated";

revoke update on table "public"."stripe_subscriptions" from "authenticated";

revoke delete on table "public"."stripe_subscriptions" from "service_role";

revoke insert on table "public"."stripe_subscriptions" from "service_role";

revoke references on table "public"."stripe_subscriptions" from "service_role";

revoke select on table "public"."stripe_subscriptions" from "service_role";

revoke trigger on table "public"."stripe_subscriptions" from "service_role";

revoke truncate on table "public"."stripe_subscriptions" from "service_role";

revoke update on table "public"."stripe_subscriptions" from "service_role";

revoke delete on table "public"."stripe_transactions" from "anon";

revoke insert on table "public"."stripe_transactions" from "anon";

revoke references on table "public"."stripe_transactions" from "anon";

revoke select on table "public"."stripe_transactions" from "anon";

revoke trigger on table "public"."stripe_transactions" from "anon";

revoke truncate on table "public"."stripe_transactions" from "anon";

revoke update on table "public"."stripe_transactions" from "anon";

revoke delete on table "public"."stripe_transactions" from "authenticated";

revoke insert on table "public"."stripe_transactions" from "authenticated";

revoke references on table "public"."stripe_transactions" from "authenticated";

revoke select on table "public"."stripe_transactions" from "authenticated";

revoke trigger on table "public"."stripe_transactions" from "authenticated";

revoke truncate on table "public"."stripe_transactions" from "authenticated";

revoke update on table "public"."stripe_transactions" from "authenticated";

revoke delete on table "public"."stripe_transactions" from "service_role";

revoke insert on table "public"."stripe_transactions" from "service_role";

revoke references on table "public"."stripe_transactions" from "service_role";

revoke select on table "public"."stripe_transactions" from "service_role";

revoke trigger on table "public"."stripe_transactions" from "service_role";

revoke truncate on table "public"."stripe_transactions" from "service_role";

revoke update on table "public"."stripe_transactions" from "service_role";

revoke delete on table "public"."usage" from "anon";

revoke insert on table "public"."usage" from "anon";

revoke references on table "public"."usage" from "anon";

revoke select on table "public"."usage" from "anon";

revoke trigger on table "public"."usage" from "anon";

revoke truncate on table "public"."usage" from "anon";

revoke update on table "public"."usage" from "anon";

revoke delete on table "public"."usage" from "authenticated";

revoke insert on table "public"."usage" from "authenticated";

revoke references on table "public"."usage" from "authenticated";

revoke select on table "public"."usage" from "authenticated";

revoke trigger on table "public"."usage" from "authenticated";

revoke truncate on table "public"."usage" from "authenticated";

revoke update on table "public"."usage" from "authenticated";

revoke delete on table "public"."usage" from "service_role";

revoke insert on table "public"."usage" from "service_role";

revoke references on table "public"."usage" from "service_role";

revoke select on table "public"."usage" from "service_role";

revoke trigger on table "public"."usage" from "service_role";

revoke truncate on table "public"."usage" from "service_role";

revoke update on table "public"."usage" from "service_role";

revoke delete on table "public"."users" from "anon";

revoke insert on table "public"."users" from "anon";

revoke references on table "public"."users" from "anon";

revoke select on table "public"."users" from "anon";

revoke trigger on table "public"."users" from "anon";

revoke truncate on table "public"."users" from "anon";

revoke update on table "public"."users" from "anon";

revoke delete on table "public"."users" from "authenticated";

revoke insert on table "public"."users" from "authenticated";

revoke references on table "public"."users" from "authenticated";

revoke select on table "public"."users" from "authenticated";

revoke trigger on table "public"."users" from "authenticated";

revoke truncate on table "public"."users" from "authenticated";

revoke update on table "public"."users" from "authenticated";

revoke delete on table "public"."users" from "service_role";

revoke insert on table "public"."users" from "service_role";

revoke references on table "public"."users" from "service_role";

revoke select on table "public"."users" from "service_role";

revoke trigger on table "public"."users" from "service_role";

revoke truncate on table "public"."users" from "service_role";

revoke update on table "public"."users" from "service_role";

revoke delete on table "public"."validation_logs" from "anon";

revoke insert on table "public"."validation_logs" from "anon";

revoke references on table "public"."validation_logs" from "anon";

revoke select on table "public"."validation_logs" from "anon";

revoke trigger on table "public"."validation_logs" from "anon";

revoke truncate on table "public"."validation_logs" from "anon";

revoke update on table "public"."validation_logs" from "anon";

revoke delete on table "public"."validation_logs" from "authenticated";

revoke insert on table "public"."validation_logs" from "authenticated";

revoke references on table "public"."validation_logs" from "authenticated";

revoke select on table "public"."validation_logs" from "authenticated";

revoke trigger on table "public"."validation_logs" from "authenticated";

revoke truncate on table "public"."validation_logs" from "authenticated";

revoke update on table "public"."validation_logs" from "authenticated";

revoke delete on table "public"."validation_logs" from "service_role";

revoke insert on table "public"."validation_logs" from "service_role";

revoke references on table "public"."validation_logs" from "service_role";

revoke select on table "public"."validation_logs" from "service_role";

revoke trigger on table "public"."validation_logs" from "service_role";

revoke truncate on table "public"."validation_logs" from "service_role";

revoke update on table "public"."validation_logs" from "service_role";

set check_function_bodies = off;

CREATE OR REPLACE FUNCTION public.is_org_admin(org_id text)
 RETURNS boolean
 LANGUAGE sql
 STABLE SECURITY DEFINER
AS $function$
  SELECT EXISTS (
    SELECT 1 FROM public.organization_members
    WHERE organization_id = org_id
    AND user_id = auth.uid()
    AND role = 'admin'
  );
$function$
;

CREATE OR REPLACE FUNCTION public.is_org_member(org_id text)
 RETURNS boolean
 LANGUAGE sql
 STABLE SECURITY DEFINER
AS $function$
  SELECT EXISTS (
    SELECT 1 FROM public.organization_members
    WHERE organization_id = org_id
    AND user_id = auth.uid()
  );
$function$
;

CREATE OR REPLACE FUNCTION public.is_org_owner(org_id text)
 RETURNS boolean
 LANGUAGE sql
 STABLE SECURITY DEFINER
AS $function$
  SELECT EXISTS (
    SELECT 1 FROM public.organizations
    WHERE id = org_id
    AND owner_id = auth.uid()
    AND deleted_at IS NULL
  );
$function$
;

CREATE OR REPLACE FUNCTION public.is_superadmin()
 RETURNS boolean
 LANGUAGE sql
 STABLE SECURITY DEFINER
AS $function$
  SELECT EXISTS (
    SELECT 1 FROM public.users
    WHERE id = auth.uid()
    AND is_superadmin = TRUE
    AND deleted_at IS NULL
  );
$function$
;

CREATE OR REPLACE FUNCTION public.set_updated_at()
 RETURNS trigger
 LANGUAGE plpgsql
AS $function$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.sync_auth_user_to_public()
 RETURNS trigger
 LANGUAGE plpgsql
 SECURITY DEFINER
 SET search_path TO ''
AS $function$
BEGIN
  INSERT INTO public.users (id, email, name)
  VALUES (
    NEW.id,
    NEW.email,
    COALESCE(
      NEW.raw_user_meta_data->>'name',
      NEW.raw_user_meta_data->>'full_name'
    )
  )
  ON CONFLICT (id) DO UPDATE
  SET
    email = EXCLUDED.email,
    name = COALESCE(EXCLUDED.name, public.users.name),
    updated_at = now()
  WHERE
    public.users.email IS DISTINCT FROM EXCLUDED.email
    OR public.users.name IS DISTINCT FROM EXCLUDED.name;

  RETURN NEW;
END;
$function$
;

CREATE OR REPLACE FUNCTION public.user_organizations()
 RETURNS SETOF text
 LANGUAGE sql
 STABLE SECURITY DEFINER
AS $function$
  SELECT organization_id
  FROM public.organization_members
  WHERE user_id = auth.uid();
$function$
;



